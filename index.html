<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>COALAB · 강의 영상 플레이어</title>

  <style>
    :root{
      --bg:#0b1020; --panel:#121830; --text:#e7ecff;
      --muted:#9aa4c7; --border:rgba(255,255,255,.08);
      --accent:#6fa8ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif
    }

    header,footer{border-bottom:1px solid var(--border)}
    header .inner,footer .inner{
      max-width:1200px;margin:0 auto;padding:12px 16px
    }
    header strong{font-size:18px}

    .layout{
      display:grid;grid-template-columns:320px 1fr;gap:20px;
      max-width:1200px;margin:20px auto;padding:0 16px 32px
    }

    .sidebar{
      background:var(--panel);border:1px solid var(--border);
      border-radius:14px;overflow:hidden
    }
    .sidebar-title{
      margin:0;padding:14px 16px;border-bottom:1px solid var(--border)
    }
    .playlist{list-style:none;margin:0;padding:8px}
    .item{
      display:flex;justify-content:space-between;gap:8px;
      padding:10px;margin:6px 4px;border:1px solid var(--border);
      border-radius:10px;cursor:pointer;
      background:rgba(255,255,255,.02)
    }
    .item.is-active{
      background:rgba(111,168,255,.10);
      border-color:rgba(111,168,255,.6)
    }

    .player-area{display:flex;flex-direction:column;gap:12px}
    .player-shell{
      background:var(--panel);border:1px solid var(--border);
      border-radius:14px;padding:14px
    }
    .iframe-16x9{
      position:relative;width:100%;aspect-ratio:16/9;
      border-radius:10px;overflow:hidden
    }
    .iframe-16x9 iframe{
      position:absolute;inset:0;width:100%;height:100%;
      border:0;display:block
    }
    .video-wrap{width:100%;border-radius:10px;overflow:hidden}
    .video-wrap video{
      display:block;width:100%;height:auto;max-height:80vh;
      background:#000;object-fit:contain
    }

    .muted{color:var(--muted);font-size:14px}
    .btn{
      display:inline-block;padding:8px 12px;border:1px solid var(--border);
      border-radius:8px;text-decoration:none;color:var(--text);
      background:rgba(255,255,255,.06)
    }
    .btn:hover{border-color:rgba(111,168,255,.6)}
    @media(max-width:920px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body>

<header>
  <div class="inner">
    <strong>COALAB · 강의 영상 (테스트)</strong>
  </div>
</header>

<main class="layout">
  <!-- 좌측 목록 -->
  <aside class="sidebar" aria-label="강의 목록">
    <h2 class="sidebar-title">강의 목록</h2>
    <ul id="playlist" class="playlist" role="listbox">
      <li class="item is-active" tabindex="0" role="option"
          data-type="youtube"
          data-src="https://www.youtube.com/watch?v=TVYhK3w-7VU"
          data-title="OT: 인공지능·머신러닝·딥러닝 (테스트)">
        <span>OT: 인공지능·머신러닝·딥러닝 (테스트)</span>
        <span class="muted">YouTube</span>
      </li>

      <li class="item" tabindex="0" role="option"
          data-type="youtube"
          data-src="https://www.youtube.com/watch?v=aaeciXh1FDo"
          data-title="2차시: Visual Studio Code 설치">
        <span>2차시: Visual Studio Code 설치</span>
        <span class="muted">YouTube</span>
      </li>

      <li class="item" tabindex="0" role="option"
          data-type="youtube"
          data-src="https://www.youtube.com/watch?v=M4vNgN-3CsQ"
          data-title="2-1차시: 파이썬 프로그램 PC 설치 방법">
        <span>2-1차시: 파이썬 프로그램 PC 설치 방법</span>
        <span class="muted">YouTube</span>
      </li>

      <li class="item" tabindex="0" role="option"
          data-type="youtube"
          data-src="https://www.youtube.com/watch?v=g_qU5ukUUvU"
          data-title="2-2차시: 파이썬 코랩 사용하기">
        <span>2-2차시: 파이썬 코랩 사용하기</span>
        <span class="muted">YouTube</span>
      </li>

      <li class="item" tabindex="0" role="option"
          data-type="youtube"
          data-src="https://www.youtube.com/watch?v=J22ZjOXBnnY"
          data-title="3차시: 딥러닝 실무 자료형">
        <span>3차시: 딥러닝 실무 자료형</span>
        <span class="muted">YouTube</span>
      </li>
    </ul>
  </aside>

  <!-- 우측 영상 -->
  <section class="player-area">
    <div class="player-header">
      <h2 id="videoTitle">OT: 인공지능·머신러닝·딥러닝 (테스트)</h2>
      <a id="openOnYouTube" class="btn" target="_blank" rel="noopener">YouTube에서 열기</a>
    </div>

    <div class="player-shell">
      <div id="iframeWrap" class="iframe-16x9">
        <iframe id="ytFrame"
          title="강의(YouTube)" src=""
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </div>

      <div id="videoWrap" class="video-wrap" hidden>
        <video id="html5Video" controls preload="metadata" playsinline aria-label="강의(MP4)"></video>
      </div>
    </div>

    <p class="muted">
      안 보이면: ① 콘솔 에러(404 등) ② 네트워크 상태 ③ 광고차단 확장 해제 ④ HTTP/HTTPS 확인
    </p>
  </section>
</main>

<footer>
  <div class="inner"><small>© 2025 COALAB</small></div>
</footer>

<script>
  // ====== 유틸 함수 ======
  function normalizeYouTubeURL(url){
    try {
      const u = new URL(url);
      if(u.hostname.includes('youtu.be')){
        const id = u.pathname.slice(1);
        return `https://www.youtube-nocookie.com/embed/${id}`;
      }
      if(u.hostname.includes('youtube.com') && u.pathname === '/watch'){
        const id = u.searchParams.get('v');
        return `https://www.youtube-nocookie.com/embed/${id}`;
      }
      if(u.hostname.includes('youtube.com') && u.pathname.startsWith('/embed/')){
        const id = u.pathname.split('/').pop();
        return `https://www.youtube-nocookie.com/embed/${id}`;
      }
    }catch(_){}
    return url;
  }
  function toWatchUrl(embedUrl){
    try {
      const u = new URL(embedUrl);
      if(u.pathname.startsWith('/embed/')){
        const id = u.pathname.split('/').pop();
        return `https://www.youtube.com/watch?v=${id}`;
      }
    }catch(_){}
    return embedUrl;
  }

  // ====== 주요 요소 ======
  const playlist = document.getElementById('playlist');
  const items = playlist ? Array.from(playlist.querySelectorAll('.item')) : [];
  const iframeWrap = document.getElementById('iframeWrap');
  const ytFrame = document.getElementById('ytFrame');
  const videoTitleEl = document.getElementById('videoTitle');
  const openOnYouTube = document.getElementById('openOnYouTube');
  let currentType = null;

  function stopAll(){
    if(currentType==='youtube' && ytFrame) ytFrame.src='about:blank';
  }

  function loadEntry(el){
    if(!el) return;
    const srcRaw = el.dataset.src;
    const title = el.dataset.title || '강의';

    items.forEach(li=>{
      li.classList.remove('is-active');
      li.setAttribute('aria-selected','false');
    });
    el.classList.add('is-active');
    el.setAttribute('aria-selected','true');
    stopAll();

    const finalSrc = normalizeYouTubeURL(srcRaw);
    ytFrame.src = finalSrc;
    openOnYouTube.href = toWatchUrl(finalSrc);
    videoTitleEl.textContent = title;
    currentType='youtube';
  }

  // 초기 이벤트 바인딩
  items.forEach(li=>li.addEventListener('click',()=>loadEntry(li)));
  playlist.addEventListener('keydown',e=>{
    const cur = document.activeElement.closest('.item');
    if(!cur) return;
    let idx = items.indexOf(cur);
    if(e.key==='ArrowDown'){e.preventDefault(); items[Math.min(items.length-1,idx+1)].focus();}
    if(e.key==='ArrowUp'){e.preventDefault(); items[Math.max(0,idx-1)].focus();}
    if(e.key==='Enter'||e.key===' '){e.preventDefault(); loadEntry(cur);}
  });

  // 첫 항목 자동 로드
  loadEntry(items[0]);
</script>
</body>
</html>
